<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Footage Renamer</title>
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: file:; media-src 'self' file: blob: data:; script-src 'self';">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="left">
      <button id="openFolderBtn" class="btn">Open Folder</button>
  <button id="loadRosterBtn" class="btn secondary">Load Roster</button>
      <div id="folderPath" class="folder-path"></div>
    </div>
    <div class="center">
      <div id="fileCounter" class="counter">0 / 0</div>
    </div>
    <div class="right">
  <button id="openBatchBtn" class="btn secondary">Batch Renamer</button>
      <button id="showInFolderBtn" class="btn secondary">Reveal in Finder/Explorer</button>
    </div>
  </header>

  <main class="main">
    <div class="viewer">
      <video id="video" preload="metadata" playsinline></video>

      <div class="overlay rename-overlay hidden" id="renameOverlay">
        <div class="rename-card">
          <div class="rename-label">Rename (keep extension auto):</div>
          <input id="renameInput" type="text" spellcheck="false" />
          <div class="hint">Press Enter to save • Esc to cancel</div>
        </div>
      </div>

      <div class="overlay rename-overlay hidden" id="tagOverlay">
        <div class="rename-card">
          <div class="rename-label">Tag Players (type jersey number, comma to add multiple, Enter to confirm):</div>
          <input id="tagInput" type="text" spellcheck="false" autocomplete="off" />
          <div id="currentTags" class="tag-pills"></div>
          <div id="tagSuggestions" class="suggestions"></div>
          <div class="hint">T to open • Space play/pause • Esc cancel • Enter finish tags • Use number to filter, click to add</div>
        </div>
      </div>

      <div class="overlay rename-overlay hidden" id="detailsOverlay">
        <div class="rename-card">
          <div class="rename-label">Extra Details (enter descriptor, then Enter to finish):</div>
          <input id="detailsInput" type="text" spellcheck="false" autocomplete="off" />
          <div class="hint">Esc to cancel • Leave blank to skip extra details</div>
        </div>
      </div>

      <div class="controls">
        <div class="row">
          <button id="prevBtn" class="btn">⟵ Prev</button>
          <button id="playPauseBtn" class="btn">Play</button>
          <button id="muteBtn" class="btn">Mute</button>
          <button id="nextBtn" class="btn">Next ⟶</button>
          <button id="deleteBtn" class="btn" style="margin-left:auto;background:#40222a;border-color:#5a2a34;">Delete</button>
        </div>

        <div class="row progress">
          <div id="currentName" class="filename">No file loaded</div>
          <div class="time">
            <span id="currentTime">00:00</span>
            <input id="seek" type="range" min="0" max="100" step="0.1" value="0" />
            <span id="duration">00:00</span>
          </div>
        </div>

        <div class="row tips">
          <span>Shortcuts: Enter tag → details → rename • T tag directly • ←/→ navigate • Space play/pause • Esc cancel</span>
        </div>
      </div>
    </div>
  </main>

  <!-- Batch Renamer Panel (Web / FS Access API) -->
  <div id="batchPanel" class="batch-panel hidden" role="dialog" aria-modal="true" aria-labelledby="batchTitle">
    <div class="batch-card">
      <div class="batch-head">
        <h2 id="batchTitle">Batch Renamer (Web / File System Access)</h2>
        <button id="closeBatchBtn" class="btn secondary">Close</button>
      </div>
      <div id="batchSupportMsg" class="batch-support"></div>

      <div class="batch-grid">
        <div class="field">
          <label>Folder</label>
          <div class="row">
            <button id="brPick" class="btn">Pick Folder</button>
            <button id="brReopen" class="btn secondary">Reopen Last</button>
            <button id="brForget" class="btn secondary">Forget Permissions</button>
          </div>
          <div id="brFolder" class="muted small"></div>
        </div>

        <div class="field">
          <label><input type="checkbox" id="brRecurse" /> Recurse into subfolders</label>
        </div>

        <div class="field">
          <label>Extensions (comma-separated)</label>
          <input id="brExts" type="text" value="mp4,mov,m4v,mkv,avi,webm,mts,m2ts" />
        </div>

        <div class="field">
          <label>Filename RegExp (optional)</label>
          <input id="brRegex" type="text" placeholder="e.g. ^(.+)$" />
        </div>

        <div class="field">
          <label>Replacement Template</label>
          <input id="brTemplate" type="text" placeholder="{name}" />
          <div class="hint">Tokens: {name}, {ext}; Groups: $1..$9</div>
        </div>

        <div class="field">
          <label>Destination Subfolder (optional)</label>
          <input id="brDest" type="text" placeholder="e.g. Renamed" />
        </div>

        <div class="field">
          <label>Conflict Policy</label>
          <select id="brConflict">
            <option value="skip">Skip</option>
            <option value="autonumber">Auto-number</option>
          </select>
        </div>

        <div class="field">
          <div class="row">
            <button id="brPreview" class="btn">Dry Run</button>
            <button id="brExecute" class="btn" disabled>Execute</button>
          </div>
          <div id="brSummary" class="muted small"></div>
        </div>
      </div>

      <div id="brLog" class="batch-log" aria-live="polite"></div>
    </div>
  </div>

  <div id="toast" class="toast hidden"></div>

  <script type="module" src="./renderer.js"></script>
</body>
</html>
